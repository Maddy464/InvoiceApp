sap.ui.define(["sap/ui/core/mvc/Controller","sap/ui/model/json/JSONModel","sap/m/MessageToast"],(e,t,n)=>{"use strict";return e.extend("invoiceui.controller.Upload",{onInit(){},onTrigger:function(e){var t=""},onNavigateToWfTrigger:function(e){var t=this.getOwnerComponent().getRouter();t.navTo("RouteWorkList")},onNavigateToInvoiceData:function(e){var t=this.getOwnerComponent().getRouter();t.navTo("RouteInvoice")},onCreate:function(e){var t=this.getOwnerComponent().getModel();var n=t.bindList("/InvoiceHeaders");let o=this.getView().getModel("invoice").getData();var a=n.create(o.header);a.created().then(function(){var e=a.getPath();o.items.forEach(t=>{const n=a.getProperty("ID");let o=a.getModel().bindList(e+"/to_items");o.create(t)})}).catch(function(e){console.error("Deep create failed:",e)})},onUploadPress:function(e){const o={};this.getView().setModel(new t(o),"invoice");const a={editable:false,refreshEnabled:false,uploadEnabled:false};this.getView().setModel(new t(a),"viewModel");const r=this.byId("fileUploader1");var i=new FileReader;i.onload=function(e){this.content=e.currentTarget.result;var t=this.byId("fileUploader1");const o=this.getView().getModel();const a=o.bindContext("/uploadFile(...)");var r=this.content;const[i,s]=r.split(";");const c=i.split(":")[1];const l=s.split(",")[1];a.setParameter("file",l);a.setParameter("fileName",t.oFileUpload.files[0].name);a.execute().then((e,t)=>{var o=a.getBoundContext();console.log(o.getObject());this.getView().getModel("invoice").setData(o.getObject().invoice);n.show("File upload action triggered successfully!")}).catch(e=>{n.show("Error triggering file upload action: "+e.message)})}.bind(this);i.readAsDataURL(this.file)},onFileChange:function(e){const t=e.getParameter("files")[0];if(t){n.show("File selected: "+t.name)}},onUploadComplete:function(e){const t=e.getParameter("response");n.show("FileUploader upload complete: "+t)},_getBaseURL:function(){var e=this.getOwnerComponent().getManifestEntry("/sap.app/id").replaceAll(".","/");return jQuery.sap.getModulePath(e)},onFileChange:function(e){var t=e.getParameters("files").files[0];this.file=t},onUploadFile:function(){var e=this.byId("__fileUploader");var t=new FileReader;t.onload=function(e){this.content=e.currentTarget.result;this.createfile(this.content)}.bind(this);t.readAsDataURL(this.file)},createfile:function(e){var t=new sap.ui.model.odata.v4.ODataModel({serviceUrl:"/media/"});var n="/MediaFile";let o=this.getView().getModel();let a=o.bindList(n);var r=e;var i=r.split(",")[1]||r;a.create({content:i,mediaType:this.file.type,fileName:this.file.name},{success:function(e){sap.m.MessageToast.show("Entity created successfully!")},error:function(e){sap.m.MessageBox.error("Error creating entity: "+e.message)}})},onUpload:function(){var e=this;var n=this.getView().byId("__fileUploader");var o=n.oFileUpload.files[0];const a=new Blob([o],{type:o.type});var r={extraction:{headerFields:["purchaseOrderNumber","netAmount","senderAddress","currencyCode"],lineItemFields:["description","netAmount","quantity","unitPrice","materialNumber","unitOfMeasure"]},clientId:"default"};var i=new FormData;i.append("options",JSON.stringify(r));i.append("file",a,o.name);var s=new t;s.loadData("oauth/token","grant_type=client_credentials",{"Content-Type":"application/json"});s.attachRequestCompleted(function(n){var o=n.getSource().getProperty("/access_token");var a={Accept:"application/json","X-Requested-With":"XMLHttpRequest",Authorization:"Bearer "+o};const r={method:"POST",headers:a,body:i};fetch("doc-info-extraction/v1/document/jobs",r).then(e=>e.text()).then(n=>{var a=JSON.parse(n);var r=a.id;fetch("doc-info-extraction/v1/document/jobs/"+r,{headers:{Authorization:"Bearer "+o}}).then(e=>e.json()).then(n=>{var o=new t({PONumber:n.extraction.headerFields.find(e=>e.name==="purchaseOrderNumber").value,Vendor:n.extraction.headerFields.find(e=>e.name==="senderAddress").value,Amount:n.extraction.headerFields.find(e=>e.name==="netAmount").rawValue,Receipt:n.fileName});e.getView().setModel(o)}).catch(e=>console.error(e))}).catch(e=>console.error(e))}.bind(this))},onSamplecodes:function(){var e=this;
// Retrieved 2025-12-07, License - CC BY-SA 3.0
var t=r;function n(e,t="",n=512){const o=atob(e.split(",")[1]);const a=[];for(let e=0;e<o.length;e+=n){const t=o.slice(e,e+n);const r=new Array(t.length);for(let e=0;e<t.length;e++){r[e]=t.charCodeAt(e)}const i=new Uint8Array(r);a.push(i)}const r=new Blob(a,{type:t});return r}const o=n(a,"pdf");var a=content;var r=a.split(",")[1]||a;function i(e,t){t=t||"application/pdf";var n=1024;var o=atob(e);var a=o.length;var r=Math.ceil(a/n);var i=new Array(r);for(var s=0;s<r;++s){var c=s*n;var l=Math.min(c+n,a);var d=new Array(l-c);for(var u=c;u<l;++u){d[u]=o[u].charCodeAt(0)}i[s]=new Uint8Array(d)}return new Blob(i,{type:t})}var s;try{const e=atob(r);const t=e.length;const n=new Uint8Array(t);for(let o=0;o<t;o++){n[o]=e.charCodeAt(o)}s=new Blob([n.buffer],{type:"application/pdf"})}catch(e){}}})});
//# sourceMappingURL=Upload.controller.js.map